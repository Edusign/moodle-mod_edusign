define("mod_edusign/pages/manage",["exports","core/ajax","core/str","core/notification","core/modal_delete_cancel","core/modal_save_cancel","core/modal","core/modal_events"],(function(_exports,_ajax,Str,_notification,_modal_delete_cancel,_modal_save_cancel,_modal,_modal_events){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_ajax=_interopRequireDefault(_ajax),Str=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(Str),_notification=_interopRequireDefault(_notification),_modal_delete_cancel=_interopRequireDefault(_modal_delete_cancel),_modal_save_cancel=_interopRequireDefault(_modal_save_cancel),_modal=_interopRequireDefault(_modal),_modal_events=_interopRequireDefault(_modal_events);const archiveSessionHandler=function(sessionId,archiveState){return _ajax.default.call([{methodname:"mod_edusign_archive_session",args:{sessionId:sessionId,archiveState:archiveState}}])[0]},askRemoveSession=function(sessionId){return new Promise((async(resolve,reject)=>_modal_delete_cancel.default.create({title:await Str.get_string("removeSession","mod_edusign"),body:"\n                <p>".concat(await Str.get_string("removeSessionQuestions","mod_edusign"),'</p>\n                <div class="form-check form-switch">\n                    <input class="form-check-input" type="checkbox" role="switch" id="removeOnEdusign" checked>\n                    <label class="form-check-label" for="removeOnEdusign">\n                    ').concat(await Str.get_string("removeSessionAndSheet","mod_edusign"),"\n                    </label>\n                </div>\n            "),show:!0,removeOnClose:!0}).then((modalInstance=>(modalInstance.getRoot().on(_modal_events.default.delete,(()=>{const removeOnEdusign=document.querySelector("#removeOnEdusign").checked;(function(sessionId){let removeOnEdusign=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return _ajax.default.call([{methodname:"mod_edusign_remove_session",args:{sessionId:sessionId,withEdusignDelete:removeOnEdusign}}])[0]})(sessionId,removeOnEdusign).then(resolve).catch(reject)})),modalInstance)))))};_exports.init=async()=>{document.querySelectorAll(".remove-session").forEach((button=>{button.addEventListener("click",(async event=>{event.preventDefault();const sessionId=button.closest("tr").dataset.sessionId;await askRemoveSession(sessionId).then((async()=>window.location.reload())).catch((async data=>{_notification.default.addNotification({message:await Str.get_string("session_removed_error","mod_edusign",(null==data?void 0:data.error)||"An unknowed error has occured"),type:"error"})}))}))}));document.querySelectorAll(".archive-session").forEach((button=>{button.addEventListener("click",(async event=>{event.preventDefault();const sessionId=button.closest("tr").dataset.sessionId;await function(sessionId){return new Promise((async(resolve,reject)=>_modal_save_cancel.default.create({title:await Str.get_string("archiveSession","mod_edusign"),body:"\n                <p>".concat(await Str.get_string("archiveSessionQuestion","mod_edusign"),"</p>\n            "),show:!0,removeOnClose:!0}).then((modalInstance=>(modalInstance.getRoot().on(_modal_events.default.save,(()=>{archiveSessionHandler(sessionId,!0).then(resolve).catch(reject)})),modalInstance)))))}(sessionId).then((async()=>window.location.reload())).catch((async data=>{_notification.default.addNotification({message:await Str.get_string("session_archived_error","mod_edusign",(null==data?void 0:data.error)||"An unknowed error has occured"),type:"error"})}))}))}));document.querySelectorAll(".unarchive-session").forEach((button=>{button.addEventListener("click",(async event=>{event.preventDefault();const sessionId=button.closest("tr").dataset.sessionId;await function(sessionId){return new Promise((async(resolve,reject)=>_modal_save_cancel.default.create({title:await Str.get_string("unarchiveSession","mod_edusign"),body:"\n                <p>".concat(await Str.get_string("unarchiveSessionQuestion","mod_edusign"),"</p>\n            "),show:!0,removeOnClose:!0}).then((modalInstance=>(modalInstance.getRoot().on(_modal_events.default.save,(()=>{archiveSessionHandler(sessionId,!1).then(resolve).catch(reject)})),modalInstance)))))}(sessionId).then((async()=>window.location.reload())).catch((async data=>{_notification.default.addNotification({message:await Str.get_string("session_unarchived_error","mod_edusign",(null==data?void 0:data.error)||"An unknowed error has occured"),type:"error"})}))}))}));document.querySelector("#import-sessions").addEventListener("click",(async event=>{event.preventDefault(),async function(){_modal.default.create({title:"Import session",body:document.querySelector("#import-csv-modal").innerHTML,show:!0,removeOnClose:!0}).then((modalInstance=>(modalInstance.getRoot().querySelector("#import-session-form").addEventListener("submit",(async event=>{event.preventDefault();const form=event.target,file=new FormData(form).get("import-session-file"),response=await _ajax.default.call([{methodname:"mod_edusign_import_session",args:{file:file}}])[0];if(response.success)return _notification.default.addNotification({message:await Str.get_string("session_imported","mod_edusign"),type:"success"}),modalInstance.hide(),window.location.reload();_notification.default.addNotification({message:await Str.get_string("session_imported_error","mod_edusign",response.error||"An unknowed error has occured"),type:"error"})})),modalInstance)))}()}))}}));

//# sourceMappingURL=manage.min.js.map